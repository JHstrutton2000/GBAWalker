const unsigned char PlayerSprites[] =
{
 0x00,0x00,0x07,0x07,0x08,0x0F,0x10,0x1F,
  0x16,0x1F,0x28,0x29,0x22,0x2A,0x12,0x1A,
  0x08,0x0C,0x17,0x1F,0x20,0x3C,0x48,0x7E,
  0x48,0x6F,0x38,0x3F,0x09,0x0F,0x09,0x09,
  0x00,0x00,0xE0,0xE0,0x10,0xF0,0x08,0xF8,
  0x68,0xF8,0x14,0x94,0x44,0x54,0x48,0x58,
  0x10,0x30,0xE8,0xF8,0x04,0x3C,0x12,0x7E,
  0x12,0xF6,0x1C,0xFC,0x90,0xF0,0x90,0x90,
  0x00,0x00,0x07,0x07,0x08,0x0F,0x10,0x1F,
  0x16,0x1F,0x11,0x19,0x14,0x14,0x14,0x14,
  0x08,0x09,0x07,0x07,0x04,0x04,0x05,0x05,
  0x05,0x07,0x04,0x07,0x06,0x07,0x06,0x06,
  0x00,0x00,0xE0,0xE0,0x10,0xF0,0x08,0xF8,
  0x08,0xF8,0x08,0x98,0x08,0x98,0x08,0xB8,
  0x10,0xF0,0xE0,0xE0,0x20,0xE0,0x20,0xE0,
  0x20,0x60,0xC0,0xC0,0x40,0xC0,0x40,0x40,
  0x00,0x00,0x07,0x07,0x08,0x0F,0x10,0x1F,
  0x10,0x1F,0x10,0x19,0x10,0x19,0x10,0x1D,
  0x08,0x0F,0x07,0x07,0x04,0x07,0x04,0x07,
  0x04,0x06,0x03,0x03,0x02,0x03,0x02,0x02,
  0x00,0x00,0xE0,0xE0,0x10,0xF0,0x08,0xF8,
  0x68,0xF8,0x88,0x98,0x28,0x28,0x28,0x28,
  0x10,0x90,0xE0,0xE0,0x20,0x20,0xA0,0xA0,
  0xA0,0xE0,0x20,0xE0,0x60,0xE0,0x60,0x60,
  0x00,0x00,0x07,0x07,0x08,0x0F,0x10,0x1F,
  0x10,0x1F,0x20,0x2F,0x20,0x2F,0x10,0x1F,
  0x08,0x0F,0x16,0x1F,0x20,0x3F,0x48,0x7F,
  0x48,0x6F,0x38,0x3F,0x09,0x0F,0x09,0x0F,
  0x00,0x00,0xE0,0xE0,0x10,0xF0,0x08,0xF8,
  0x08,0xF8,0x04,0xF4,0x04,0xF4,0x08,0xF8,
  0x10,0xF0,0x68,0xF8,0x04,0xFC,0x12,0xFE,
  0x12,0xF6,0x1C,0xFC,0x90,0xF0,0x90,0xF0,
  0x00,0x00,0x07,0x07,0x08,0x0F,0x10,0x1F,
  0x16,0x1F,0x28,0x29,0x22,0x2A,0x12,0x1A,
  0x08,0x0C,0x17,0x1F,0x20,0x3C,0x28,0x2E,
  0x1E,0x1F,0x09,0x09,0x09,0x0F,0x07,0x07,
  0x00,0x00,0xE0,0xE0,0x10,0xF0,0x08,0xF8,
  0x68,0xF8,0x14,0x94,0x44,0x54,0x48,0x58,
  0x10,0x30,0xE8,0xF8,0x04,0x3C,0x24,0x7C,
  0x24,0xEC,0x38,0xF8,0xE0,0xE0,0xC0,0xC0,
  0x00,0x00,0x07,0x07,0x08,0x0F,0x10,0x1F,
  0x16,0x1F,0x28,0x29,0x22,0x2A,0x12,0x1A,
  0x08,0x0C,0x17,0x1F,0x20,0x3C,0x24,0x3E,
  0x24,0x37,0x1C,0x1F,0x07,0x07,0x03,0x03,
  0x00,0x00,0xE0,0xE0,0x10,0xF0,0x08,0xF8,
  0x68,0xF8,0x14,0x94,0x44,0x54,0x48,0x58,
  0x10,0x30,0xE8,0xF8,0x04,0x3C,0x14,0x74,
  0x78,0xF8,0x90,0x90,0x90,0xF0,0xE0,0xE0,
  0x00,0x00,0x07,0x07,0x08,0x0F,0x10,0x1F,
  0x16,0x1F,0x11,0x19,0x14,0x14,0x14,0x14,
  0x08,0x09,0x07,0x07,0x05,0x05,0x06,0x07,
  0x0E,0x0E,0x09,0x0B,0x04,0x05,0x03,0x03,
  0x00,0x00,0xE0,0xE0,0x10,0xF0,0x08,0xF8,
  0x08,0xF8,0x08,0x98,0x08,0x98,0x08,0xB8,
  0x10,0xF0,0xF0,0xF0,0x90,0xF0,0x18,0xF8,
  0x24,0xF4,0xD4,0xF4,0xF8,0xF8,0x00,0x00,
  0x00,0x00,0x07,0x07,0x08,0x0F,0x10,0x1F,
  0x16,0x1F,0x11,0x19,0x14,0x14,0x14,0x14,
  0x08,0x09,0x0F,0x0F,0x0A,0x0A,0x06,0x06,
  0x07,0x07,0x04,0x05,0x02,0x02,0x01,0x01,
  0x00,0x00,0xE0,0xE0,0x10,0xF0,0x08,0xF8,
  0x08,0xF8,0x08,0x98,0x08,0x98,0x08,0xB8,
  0x18,0xF8,0xE4,0xFC,0x02,0x7E,0x12,0xF6,
  0x9C,0xFC,0x14,0xF4,0x78,0xF8,0x80,0x80,
  0x00,0x00,0x07,0x07,0x08,0x0F,0x10,0x1F,
  0x10,0x1F,0x10,0x19,0x10,0x19,0x10,0x1D,
  0x18,0x1F,0x27,0x3F,0x40,0x7E,0x48,0x6F,
  0x39,0x3F,0x28,0x2F,0x1E,0x1F,0x01,0x01,
  0x00,0x00,0xE0,0xE0,0x10,0xF0,0x08,0xF8,
  0x68,0xF8,0x88,0x98,0x28,0x28,0x28,0x28,
  0x10,0x90,0xF0,0xF0,0x50,0x50,0x60,0x60,
  0xE0,0xE0,0x20,0xA0,0x40,0x40,0x80,0x80,
  0x00,0x00,0x07,0x07,0x08,0x0F,0x10,0x1F,
  0x10,0x1F,0x10,0x19,0x10,0x19,0x10,0x1D,
  0x08,0x0F,0x0F,0x0F,0x09,0x0F,0x18,0x1F,
  0x24,0x2F,0x2B,0x2F,0x1F,0x1F,0x00,0x00,
  0x00,0x00,0xE0,0xE0,0x10,0xF0,0x08,0xF8,
  0x68,0xF8,0x88,0x98,0x28,0x28,0x28,0x28,
  0x10,0x90,0xE0,0xE0,0xA0,0xA0,0x60,0xE0,
  0x70,0x70,0x90,0xD0,0x20,0xA0,0xC0,0xC0,
  0x00,0x00,0x07,0x07,0x08,0x0F,0x10,0x1F,
  0x10,0x1F,0x20,0x2F,0x20,0x2F,0x10,0x1F,
  0x08,0x0F,0x16,0x1F,0x20,0x3F,0x28,0x2F,
  0x1E,0x1F,0x09,0x0F,0x09,0x09,0x07,0x07,
  0x00,0x00,0xE0,0xE0,0x10,0xF0,0x08,0xF8,
  0x08,0xF8,0x04,0xF4,0x04,0xF4,0x08,0xF8,
  0x10,0xF0,0x68,0xF8,0x04,0xFC,0x24,0xFC,
  0x24,0xEC,0x38,0xF8,0xE0,0xE0,0xC0,0xC0
};

const unsigned char Enemy[] =
{
  0x00,0x00,0x7E,0x7E,0x7B,0x45,0xFF,0xC1,
  0xFE,0x8E,0xFC,0x84,0xEC,0x94,0xEC,0x94,
  0xEC,0x94,0x7C,0x44,0x7C,0x44,0x7C,0x44,
  0x7C,0x44,0x7C,0x44,0x44,0x7C,0x7C,0x7C,
  0x00,0x00,0x7E,0x7E,0xDE,0xA2,0xFF,0x83,
  0x7F,0x71,0x3F,0x21,0x37,0x29,0x37,0x29,
  0x37,0x29,0x3E,0x22,0x3E,0x22,0x3E,0x22,
  0x3E,0x22,0x3E,0x22,0x22,0x3E,0x3E,0x3E,
  0x00,0x00,0x7E,0x7E,0x42,0x7E,0x42,0x7E,
  0x5A,0x66,0x7E,0x42,0x5A,0x66,0x5A,0x66,
  0x5A,0x66,0x7E,0x42,0x7E,0x42,0x7E,0x42,
  0x7E,0x42,0x7E,0x42,0x42,0x7E,0x7E,0x7E,
  0x00,0x00,0x7E,0x7E,0x7E,0x42,0x5A,0x66,
  0x7E,0x42,0x7E,0x42,0x5A,0x66,0x5A,0x66,
  0x5A,0x66,0x7E,0x42,0x7E,0x42,0x7E,0x42,
  0x7E,0x42,0x7E,0x42,0x42,0x7E,0x7E,0x7E,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
};

void updatePlayer(void) {
    if(playerDead && (shadow_OAM[0].tile != emptyTile || shadow_OAM[1].tile != emptyTile)){
        shadow_OAM[0].tile = emptyTile;
        shadow_OAM[1].tile = emptyTile;
    }

    switch (playerDir)
    {
        case backward:
            if (counter < 5 || !Walking)
                shadow_OAM[0].tile = backwardStill;
            else
                shadow_OAM[0].tile = backwardWalk;
            break;
        case left:
            if (counter < 5 || !Walking)
                shadow_OAM[0].tile = leftStill;
            else
                shadow_OAM[0].tile = leftWalk;
            break;
        case right:
            if (counter < 5 || !Walking)
                shadow_OAM[0].tile = rightStill;
            else
                shadow_OAM[0].tile = rightWalk;
            break;
        case forward:
            if (counter < 5 || !Walking)
                shadow_OAM[0].tile = forwardStill;
            else
                shadow_OAM[0].tile = forwardWalk;
            break;
        
        default:
            break;
    }

    if (playerDir)
        shadow_OAM[1].tile = shadow_OAM[0].tile + 1;

    if (playerDir == none && !Walking) {
        if (shadow_OAM[0].tile == forwardWalk)
            shadow_OAM[0].tile = forwardStill;
        else if (shadow_OAM[0].tile == leftWalk)
            shadow_OAM[0].tile = leftStill;
        else if (shadow_OAM[0].tile == rightWalk)
            shadow_OAM[0].tile = rightStill;
        else if (shadow_OAM[0].tile == backwardWalk)
            shadow_OAM[0].tile = backwardStill;

        shadow_OAM[1].tile = shadow_OAM[0].tile + 1;

        Walking = 0;
    }
    else {
        playerDir = none;
    }

    shadow_OAM[0].x = playerX - 4;
    shadow_OAM[0].y = playerY;

    shadow_OAM[1].x = playerX + 4;
    shadow_OAM[1].y = playerY;

    if(running){
        printPlayerHealth();
    }

    if(playerHealth <= 0){
        playerDead = false;
        running = 0;

        printfTileMap("Press Start");

    }
}

void playerAttack(){

}

void printPlayerHealth(){
    char healthStr[4]; 
    sprintf(healthStr, "%d", playerHealth);

    printfTileMap(healthStr);
}

void EnemyAttackPlayer(){
    playerHealth--;

    if(playerHealth==9){
        printfTileMap("  ");
    }
}

void EnemyfollowPlayer(){
    int deltaX = constrain(playerX - enemyX, -enemyAcc, enemyAcc);
    int deltaY = constrain(playerY - enemyY, -enemyAcc, enemyAcc);

    if(deltaX > 0){
        enemyDir = right;
    }
    else if(deltaX < 0){
        enemyDir = left;
    }
    else if(deltaY > 0){
        enemyDir = forward;
    }
    else if(deltaY < 0){
        enemyDir = backward;
    }

    enemyXvel = constrain(enemyXvel + deltaX, -enemySpeed, enemySpeed);
    enemyYvel = constrain(enemyYvel + deltaY, -enemySpeed, enemySpeed);
}

void updateEnemy(){
    if(running){
        EnemyfollowPlayer();
    }

    if (((playerX - enemyX) < enemyAttackRadius) &&
        ((playerX - enemyX) > -enemyAttackRadius) &&
        ((playerY - enemyY) < enemyAttackRadius) &&
        ((playerY - enemyY) > -enemyAttackRadius)) {
        EnemyAttackPlayer();
    }


    switch (enemyDir)
    {
        case backward:
            shadow_OAM[2].tile = Enemybackward;
            break;
        case left:
            shadow_OAM[2].tile = Enemyleft;
            break;
        case right:
            shadow_OAM[2].tile = Enemyright;
            break;
        case forward:
            shadow_OAM[2].tile = Enemyforward;
            break;
        default:
            break;
    }

    enemyX += enemyXvel;
    enemyY += enemyYvel;

    shadow_OAM[2].x = enemyX;
    shadow_OAM[2].y = enemyY;
}